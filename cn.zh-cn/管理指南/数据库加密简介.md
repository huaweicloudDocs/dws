# 数据库加密简介<a name="dws_01_0115"></a>

## DWS数据库加密<a name="section6440145262618"></a>

在DWS中，您可以为集群启用数据库加密，以保护静态数据。当您为集群启用加密时，该集群及其快照的数据都会得到加密处理。您可以在创建集群时启用加密。加密是集群的一项可选且不可变的设置。要从未加密的集群更改为加密集群\(或反之\)，必须从现有集群导出数据，然后在已启用数据库加密的新集群中重新导入这些数据。

如果希望加密，可以在集群创建时启用加密。虽然加密是DWS集群中的一项可选设置，但我们建议您为包含敏感数据的集群启用该设置。

## 使用KMS服务为DWS加密数据库<a name="section18974175462716"></a>

当选择KMS（密钥管理服务）对DWS进行密钥管理时，加密密钥层次结构有三层。按层次结构顺序排列，这些密钥为主密钥、集群加密密钥 \(CEK\)、数据库加密密钥 \(DEK\)。

-   主密钥用于给CEK加密，保存在KMS中。
-   CEK用于加密DEK，CEK明文保存在DWS内存中，密文保存在DWS中。
-   DEK用于加密数据库中的数据，DEK明文保存在集群内存中，密文保存在DWS中。

当您选择主密钥后，DWS会随机生成CEK和DEK，使用用户所选的主密钥对CEK进行加密，KMS将加密后的CEK导出到DWS中，DWS使用CEK对DEK进行加密，加密后的DEK导出到DWS中，DWS会通过通道将DEK传递到集群中并加载到内存中。当该集群重启时，集群会自动通过API向DWS请求DEK，DWS将CEK、DEK加载到内存中，再调用KMS使用主秘钥CMK来解密CEK，并加载到内存中，最后用CEK解密DEK，并加载到内存中，返回给集群。

## 加密密钥轮转<a name="section124571220182719"></a>

在DWS中，您可以轮转已加密集群的加密密钥。当您为指定集群启动密钥轮转时，DWS会轮转该集群的CEK，而集群相关的快照则不需要轮转CEK，因为CEK不会在集群快照中进行保存，CEK明文是保存在DWS内存中的，密文是保存在DWS中的。您可以根据业务需求和数据类型计划多久轮转一次加密密钥。为了提高数据的安全性，建议用户定期执行轮转密钥以避免密钥被破解的风险。一旦您发现密钥可能已泄露，请及时轮换密钥。

