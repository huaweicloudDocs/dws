# 扩容集群<a name="dws_01_0023"></a>

用户需要更多的计算资源或存储资源以满足业务需要时，可以在管理控制台扩容已有集群，增加新节点。

新扩容的节点默认是按需计费。用户可以再购买和新扩容节点个数和规格相同的预付费节点，这样新的节点也可以按照优惠价格收费。

## 扩容对系统的影响<a name="section60787995155336"></a>

-   扩容前，需退出创建了临时表的客户端连接，因为在扩容过程中及扩容成功后之前创建的临时表将会失效，操作临时表也会失败。但是，扩容后创建的临时表不受影响。
-   正在扩容的集群将禁用重启集群、扩容集群、创建快照、重置集群管理员密码和删除集群的功能。
-   扩容过程中，集群会自动重启，因此集群会有一段时间变为“不可用“状态，重启成功后集群变回“可用“状态。然后，在扩容结束阶段，系统会将集群中用户数据在全部节点重新动态分布，重分布时，集群无法写入新数据，为“只读“状态。

    在重分布执行过程中，用户应当避免执行超过20分钟的查询（在重分布执行时申请写锁的默认时间为20分钟）。否则可能导致重分布出现等待加锁超时失败的问题。

-   扩容后，如果集群创建新快照，将包含扩容节点上的数据。
-   如果集群扩容失败，数据库会在后台自动执行扩容回滚操作，集群会恢复到扩容前的节点个数。
    -   如果回滚成功，集群仍可以正常使用，用户可以重新执行“扩容“操作，如果仍扩容失败，请及时联系技术支持人员进行处理。
    -   如果数据库因为某些异常原因后台回滚失败，则集群可能会变为“不可用“状态，此时无法再执行“扩容“或重启集群的操作，请及时联系技术支持人员进行处理。


## 前提条件<a name="section6414583815542"></a>

-   请确定需要扩容的集群处于“可用“、“只读“或者“低性能“任意一种状态。
-   请确定需要扩容的集群当前节点数小于或等于“29“。如果需要扩容的集群当前节点数大于“29“，用户可以在管理控制台右上方单击“工单 \> 新建工单“，申请增加节点配额，一个集群最多支持128个节点。
-   请确定计划扩容的节点数小于等于用户节点数的剩余配额，否则系统会提示无法进行扩容操作。用户可使用的节点数可在“集群管理“页面查看。

## 扩容集群<a name="section31992607155626"></a>

1.  通过访问以下地址登录DWS管理控制台：[https://console.huaweicloud.com/dws](https://console.huaweicloud.com/dws)。
2.  单击“集群管理“。

    默认显示用户所有的集群列表。

3.  在集群列表中，在指定集群所在行的“操作“列，选择“更多  \>  扩容“。

    系统将显示扩容页面。

    **图 1**  扩容集群<a name="fig1111204312162"></a>  
    ![](figures/扩容集群.png "扩容集群")

4.  在“扩容到“选择一个扩容后的节点数。
    -   扩容后的节点数量，在原节点数量的基础上，须至少增加3个节点，最多可增加的节点个数为节点剩余配额的最大值。并且，此处设置的扩容后的节点数量不能超过32个节点。

        如果可使用的节点配额不足，用户可以单击“申请更多配额“以提工单的形式申请更多节点配额。

        如果有符合业务需求的预付费节点，建议先使用预付费节点，可以节约费用。如果没有，可以单击“购买预付费节点“进行购买。

    -   扩容增加的节点规格，默认与集群当前各节点的规格相同。
    -   扩容后的集群与原集群的虚拟私有云、子网和安全组也相同。

5.  单击“立即申请“。
6.  单击“提交“。
    -   提交扩容申请后，集群的“任务信息“显示为“节点扩容“，扩容需要时间请耐心等待。扩容过程中，集群会自动重启，因此会有一段时间“集群状态“显示为“不可用“，重启成功后“集群状态“会变成“可用“。然后，在扩容结束阶段，集群将重新分布数据，重分布过程中“集群状态“为“只读“。
    -   只有“集群状态“显示为“可用“且“任务信息“显示的“节点扩容“状态结束，才表示扩容成功，用户可以开始使用集群。
    -   如果集群的“任务信息“显示为“扩容失败“，表示集群扩容失败。


